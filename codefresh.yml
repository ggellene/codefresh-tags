version: '1.0'
steps:
  Init:
    title: Build a basic image to get metadata from
    type: build
    image_name: parkhubprime/test-${{CF_REPO_NAME}}
    dockerfile: Dockerfile
  Metadata:
    title: Get image metadata
    image: ${{Init}}
    commands:
      - cf_export IMAGE_VERSION=$(npm --loglevel silent run ver)
  FinalBuild:
    title: Building Docker Image
    type: build
    image_name: parkhubprime/test-${{CF_REPO_NAME}}
    tag: ${{CF_BRANCH_TAG_NORMALIZED}} ${{IMAGE_VERSION}}
    dockerfile: Dockerfile
